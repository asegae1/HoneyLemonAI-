<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>honeylemonai</title>
  <style>
    /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fffdf0; margin: 0; display: flex; flex-direction: column; height: 100vh; color: #333; }
    
    /* honeylemonai ãƒ­ã‚´ (CSSã®ã¿) */
    .header { background: #fff; padding: 10px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; z-index: 10; }
    .logo { font-weight: 900; font-size: 24px; background: linear-gradient(90deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border-left: 6px solid #FFD700; padding-left: 12px; letter-spacing: -1px; }
    
    /* è¨­å®šã‚¨ãƒªã‚¢ */
    .config { background: #fdfae6; padding: 10px 20px; display: flex; flex-wrap: wrap; gap: 15px; font-size: 11px; align-items: center; border-bottom: 1px solid #eee; }
    .config select, .config input { border: 1px solid #ddd; border-radius: 4px; padding: 2px 5px; background: #fff; }

    /* ãƒãƒ£ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ */
    #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
    .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.6; position: relative; word-wrap: break-word; }
    
    /* HoneyLemon ã‚«ãƒ©ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .user { align-self: flex-end; background: #FFA500; color: white; border-bottom-right-radius: 2px; box-shadow: 0 2px 8px rgba(255, 165, 0, 0.3); }
    
    /* AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
    .ai { align-self: flex-start; background: #fff; border: 1px solid #eee; border-bottom-left-radius: 2px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); white-space: pre-wrap; }
    
    /* ç”»åƒè¡¨ç¤ºç”¨ */
    .img-container { margin-top: 8px; border-radius: 10px; overflow: hidden; border: 3px solid #FFD700; background: #eee; min-height: 200px; display: flex; align-items: center; justify-content: center; }
    .img-result { width: 100%; height: auto; display: block; }
    .prompt-label { font-size: 10px; color: #999; margin-top: 5px; display: block; font-style: italic; }

    /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
    .input-area { background: #fff; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #eee; align-items: center; }
    #input { flex: 1; padding: 12px 20px; border: 2px solid #eee; border-radius: 25px; outline: none; transition: 0.3s; font-size: 14px; }
    #input:focus { border-color: #FFD700; }
    
    /* é€ä¿¡ãƒœã‚¿ãƒ³ */
    button { background: #FFD700; border: none; padding: 10px 25px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: 0.2s; color: #555; }
    button:hover { background: #f0c600; transform: translateY(-1px); }
    button:disabled { background: #ccc; cursor: not-allowed; transform: none; }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .loading-dots::after { content: '...'; animation: dots 1.5s infinite; }
    @keyframes dots { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } }
  </style>
</head>
<body>

<div class="header">
  <div class="logo">honeylemonai</div>
  <div id="status" style="font-size: 10px; color: #999; font-weight: bold;">SYSTEM READY</div>
</div>

<div class="config">
  <label>ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«: 
    <select id="mode">
      <option value="chat">ä¼šè©±ãƒ¢ãƒ¼ãƒ‰</option>
      <option value="coder">ã‚³ãƒ¼ãƒ‰ä½œæˆ</option>
      <option value="image">ç”»åƒç”Ÿæˆ (Hugging Face)</option>
    </select>
  </label>
  <label>â³ åˆ¶é™: <input id="rate" type="number" value="3" style="width:35px;">ç§’</label>
  <span id="countdown" style="color: #e67e22; font-weight: bold;"></span>
</div>

<div id="chat-box"></div>

<div class="input-area">
  <input id="input" type="text" placeholder="AIã«ç›¸è«‡ã™ã‚‹ã‹ã€ç”»åƒã®èª¬æ˜ã‚’å…¥åŠ›..." autocomplete="off">
  <button id="btn" onclick="send()">é€ä¿¡</button>
</div>

<script>
  let lastSent = 0;

  // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ç›£è¦–
  function updateTimer() {
    const wait = document.getElementById('rate').value * 1000;
    const now = Date.now();
    const remaining = Math.ceil((lastSent + wait - now) / 1000);
    const btn = document.getElementById('btn');
    const timer = document.getElementById('countdown');

    if (remaining > 0) {
      btn.disabled = true;
      timer.innerText = remaining + "s";
      setTimeout(updateTimer, 500);
    } else {
      btn.disabled = false;
      timer.innerText = "";
    }
  }

  async function send() {
    const input = document.getElementById('input');
    const text = input.value.trim();
    const mode = document.getElementById('mode').value;
    
    if (!text) return;

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    addMessage(text, 'user');
    input.value = '';
    
    // å¾…æ©ŸçŠ¶æ…‹
    lastSent = Date.now();
    updateTimer();
    const status = document.getElementById('status');
    status.innerText = mode === 'image' ? "GENERATING IMAGE..." : "THINKING...";
    status.classList.add('loading-dots');

    try {
      const endpoint = mode === 'image' ? '/api/image' : '/api/chat';
      const response = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          prompt: text,
          tool: mode // chat ã‹ coder ã‹ã‚’ã‚µãƒ¼ãƒãƒ¼ã«ä¼ãˆã‚‹
        })
      });

      const data = await response.json();

      if (mode === 'image') {
        if (data.image) {
          addImageMessage(data.image, data.prompt);
        } else {
          addMessage("ç”Ÿæˆã‚¨ãƒ©ãƒ¼: " + (data.error || "ä¸æ˜ãªç†ç”±"), 'ai');
        }
      } else {
        const content = data.choices[0].message.content;
        addMessage(content, 'ai');
      }
    } catch (e) {
      addMessage("æ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚", 'ai');
    } finally {
      status.innerText = "SYSTEM READY";
      status.classList.remove('loading-dots');
    }
  }

  function addMessage(text, type) {
    const box = document.getElementById('chat-box');
    const div = document.createElement('div');
    div.className = `msg ${type}`;
    div.innerText = text;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  }

  function addImageMessage(base64, prompt) {
    const box = document.getElementById('chat-box');
    const div = document.createElement('div');
    div.className = 'msg ai';
    div.innerHTML = `
      <div>ç”»åƒã‚’ç”Ÿæˆã—ã¾ã—ãŸ:</div>
      <div class="img-container">
        <img src="${base64}" class="img-result" alt="${prompt}">
      </div>
      <span class="prompt-label">Prompt: ${prompt}</span>
    `;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  }

  // Enterã‚­ãƒ¼ã§é€ä¿¡
  document.getElementById('input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !document.getElementById('btn').disabled) send();
  });
</script>
</body>
</html>
