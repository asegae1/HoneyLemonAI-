<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>honeylemonai - Pro</title>
  <style>
    body { font-family: sans-serif; background: #fffdf0; margin: 0; display: flex; flex-direction: column; height: 100vh; }
    .header { background: #fff; padding: 15px 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; }
    .logo { font-weight: 900; font-size: 24px; background: linear-gradient(90deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border-left: 6px solid #FFD700; padding-left: 12px; }
    #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.6; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .user { align-self: flex-end; background: #FFA500; color: white; border-bottom-right-radius: 2px; }
    .ai { align-self: flex-start; background: #fff; border: 1px solid #eee; border-bottom-left-radius: 2px; }
    .img-result { width: 100%; max-width: 512px; border-radius: 12px; border: 4px solid #FFD700; margin-top: 10px; }
    .dl-btn { display: inline-block; margin-top: 10px; padding: 8px 15px; background: #4CAF50; color: white; text-decoration: none; border-radius: 10px; font-size: 12px; font-weight: bold; }
    .input-area { background: #fff; padding: 20px; display: flex; flex-direction: column; gap: 10px; border-top: 1px solid #eee; }
    .controls { display: flex; gap: 10px; }
    select, input[type="text"] { border: 2px solid #eee; border-radius: 20px; padding: 10px; outline: none; }
    input[type="text"] { flex: 1; }
    .file-label { background: #eee; padding: 10px; border-radius: 20px; cursor: pointer; font-size: 12px; text-align: center; }
    button { background: #FFD700; border: none; padding: 0 25px; border-radius: 25px; font-weight: bold; cursor: pointer; color: #555; }
    button:disabled { background: #ccc; }
  </style>
</head>
<body>

<div class="header">
  <div class="logo">honeylemonai</div>
  <div id="status" style="font-size:10px; color:#999;">READY</div>
</div>

<div id="chat-box"></div>

<div class="input-area">
  <div class="controls">
    <select id="mode">
      <option value="chat">ä¼šè©±</option>
      <option value="image">å†™çœŸã‚’ä½œã‚‹</option>
    </select>
    <input id="input" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¾ãŸã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ..." autocomplete="off">
    <label class="file-label">
      ğŸ“ è§£æ
      <input type="file" id="fileInput" style="display:none" onchange="analyzeFile()">
    </label>
    <button id="sendBtn" onclick="run()">é€ä¿¡</button>
  </div>
</div>

<script>
  // å†™çœŸç”Ÿæˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
  function createDownloadLink(base64Data) {
    const a = document.createElement('a');
    a.href = base64Data;
    a.download = `honeylemonai_${Date.now()}.png`;
    a.className = 'dl-btn';
    a.innerText = 'ğŸ“¥ ç”»åƒã‚’ä¿å­˜';
    return a;
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«è§£ææ©Ÿèƒ½ (TXT, C#, PNG, MP4)
  async function analyzeFile() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) return;

    addMsg(`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­: ${file.name} (${file.type || 'unknown'})`, 'user');

    // ãƒ†ã‚­ã‚¹ãƒˆç³» (txt, cs)
    if (file.name.endsWith('.txt') || file.name.endsWith('.cs')) {
      const text = await file.text();
      addMsg(`ã€è§£æçµæœã€‘\nç¨®é¡: ãƒ†ã‚­ã‚¹ãƒˆ/ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\nå†…å®¹:\n${text.substring(0, 300)}...`, 'ai');
    } 
    // ç”»åƒç³» (png)
    else if (file.type.startsWith('image/')) {
      addMsg(`ã€è§£æçµæœã€‘\nç¨®é¡: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«\nã‚µã‚¤ã‚º: ${file.size} bytes\nAIã§ã“ã®ç”»åƒã®å†…å®¹ã‚’èª¬æ˜ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ`, 'ai');
    }
    // å‹•ç”»ç³» (mp4)
    else if (file.type.startsWith('video/')) {
      addMsg(`ã€è§£æçµæœã€‘\nç¨®é¡: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«\nåå‰: ${file.name}\nå‹•ç”»ã®è§£æã«ã¯å°‚ç”¨ã®AIãƒ¢ãƒ‡ãƒ«ãŒå¿…è¦ã§ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯æ­£å¸¸ã§ã™ã€‚`, 'ai');
    } else {
      addMsg("æœªå¯¾å¿œã®å½¢å¼ã§ã™ãŒã€ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦èªè­˜ã—ã¾ã—ãŸã€‚", 'ai');
    }
  }

  async function run() {
    const input = document.getElementById('input');
    const text = input.value.trim();
    const mode = document.getElementById('mode').value;
    const btn = document.getElementById('sendBtn');
    
    if (!text) return;
    addMsg(text, 'user');
    input.value = '';
    btn.disabled = true;

    try {
      const endpoint = mode === 'image' ? '/api/image' : '/api/chat';
      const response = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: text })
      });

      const data = await response.json();

      if (mode === 'image' && data.image) {
        const div = document.createElement('div');
        div.className = 'msg ai';
        div.innerHTML = `<div>å†™çœŸã‚’ç”Ÿæˆã—ã¾ã—ãŸ:</div>`;
        const img = document.createElement('img');
        img.src = data.image;
        img.className = 'img-result';
        div.appendChild(img);
        div.appendChild(createDownloadLink(data.image)); // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³è¿½åŠ 
        document.getElementById('chat-box').appendChild(div);

        // 1åˆ†3å›ãƒšãƒ¼ã‚¹å®ˆã‚‹ãŸã‚ã®20ç§’å¾…æ©Ÿ
        startTimer(20);
      } else {
        addMsg(data.choices ? data.choices[0].message.content : (data.error || "ã‚¨ãƒ©ãƒ¼"), 'ai');
        btn.disabled = false;
      }
    } catch (e) {
      addMsg("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", 'ai');
      btn.disabled = false;
    }
    
    const b = document.getElementById('chat-box');
    b.scrollTop = b.scrollHeight;
  }

  function startTimer(sec) {
    const btn = document.getElementById('sendBtn');
    let count = sec;
    const timer = setInterval(() => {
      count--;
      btn.innerText = `å¾…æ©Ÿ(${count}s)`;
      if (count <= 0) {
        clearInterval(timer);
        btn.innerText = "é€ä¿¡";
        btn.disabled = false;
      }
    }, 1000);
  }

  function addMsg(t, type) {
    const b = document.getElementById('chat-box');
    const d = document.createElement('div');
    d.className = `msg ${type}`;
    d.innerText = t;
    b.appendChild(d);
    b.scrollTop = b.scrollHeight;
  }
</script>
</body>
</html>
