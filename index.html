<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>honeylemonai - DIY</title>
    <style>
        body { font-family: sans-serif; background: #fffdf0; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header { background: #fff; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        .logo { font-weight: 900; font-size: 24px; color: #FFA500; border-bottom: 3px solid #FFD700; display: inline-block; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { max-width: 80%; padding: 12px; border-radius: 15px; font-size: 14px; line-height: 1.5; }
        .user { align-self: flex-end; background: #FFA500; color: white; }
        .ai { align-self: flex-start; background: #fff; border: 1px solid #eee; }
        .img-result { width: 100%; max-width: 400px; border-radius: 10px; border: 3px solid #FFD700; margin-top: 10px; }
        .input-area { background: #fff; padding: 20px; display: flex; gap: 10px; border-top: 1px solid #eee; }
        input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; }
        button { background: #FFD700; border: none; padding: 0 20px; border-radius: 25px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="header"><div class="logo">honeylemonai</div></div>
<div id="chat-box"></div>

<div class="input-area">
    <select id="mode"><option value="chat">会話</option><option value="image">画像</option></select>
    <input id="input" type="text" placeholder="メッセージを入力...">
    <button onclick="run()">送信</button>
</div>

<script>
    async function run() {
        const input = document.getElementById('input');
        const text = input.value.trim();
        const mode = document.getElementById('mode').value;
        if (!text) return;

        addMsg(text, 'user');
        input.value = '';

        if (mode === 'image') {
            // 【直通】サーバーを介さずURLを直接生成
            const seed = Math.floor(Math.random() * 999999);
            const url = `https://pollinations.ai/p/${encodeURIComponent(text)}?width=512&height=512&seed=${seed}&nologo=true`;
            
            const div = document.createElement('div');
            div.className = 'msg ai';
            div.innerHTML = `<div>生成中...</div><img src="${url}" class="img-result" onload="this.firstChild.innerText='完成！'">`;
            document.getElementById('chat-box').appendChild(div);
        } else {
            // 会話は既存のAPIを叩く
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: text })
                });
                const data = await res.json();
                addMsg(data.choices[0].message.content, 'ai');
            } catch (e) {
                addMsg("エラー。Vercelのログを確認してね。", 'ai');
            }
        }
        document.getElementById('chat-box').scrollTop = 99999;
    }

    function addMsg(t, type) {
        const b = document.getElementById('chat-box');
        const d = document.createElement('div');
        d.className = `msg ${type}`;
        d.innerText = t;
        b.appendChild(d);
        b.scrollTop = b.scrollHeight;
    }
</script>
</body>
</html>
